var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),function(t,o,r,n,s){var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},u="function"==typeof a[n]&&a[n],l=u.cache||{},i="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(e,o){if(!l[e]){if(!t[e]){var r="function"==typeof a[n]&&a[n];if(!o&&r)return r(e,!0);if(u)return u(e,!0);if(i&&"string"==typeof e)return i(e);var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}p.resolve=function(o){var r=t[e][1][o];return null!=r?r:o},p.cache={};var f=l[e]=new c.Module(e);t[e][0].call(f.exports,p,f,f.exports,this)}return l[e].exports;function p(e){var t=p.resolve(e);return!1===t?{}:c(t)}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=t,c.cache=l,c.parent=u,c.register=function(e,o){t[e]=[function(e,t){t.exports=o},{}]},Object.defineProperty(c,"root",{get:function(){return a[n]}}),a[n]=c;for(var f=0;f<o.length;f++)c(o[f]);if(r){var p=c(r);"object"==typeof exports&&"undefined"!=typeof module?module.exports=p:"function"==typeof e&&e.amd?e(function(){return p}):s&&(this[s]=p)}}({kgW6q:[function(e,t,o){e("../../../background")},{"../../../background":"8VaxY"}],"8VaxY":[function(e,t,o){async function r(e){let t=null;e.onMessage.addListener(async o=>{if("start-stream"===o.type)try{console.log("\uD83C\uDF0A \u5f00\u59cb\u5904\u7406\u6d41\u5f0f\u8bf7\u6c42:",o.data.url),t=new AbortController;let{url:r,method:n,headers:s,body:a}=o.data,u=await fetch(r,{method:n,headers:s,body:a,signal:t.signal});if(console.log("\uD83D\uDCE5 \u6d41\u5f0f\u54cd\u5e94\u72b6\u6001:",u.status,u.statusText),!u.ok){let t=await u.text();e.postMessage({type:"error",error:`HTTP ${u.status}: ${t}`});return}let l=u.body?.getReader();if(!l){e.postMessage({type:"error",error:"No readable stream available"});return}let i=new TextDecoder,c="";try{for(;;){let{done:t,value:o}=await l.read();if(t){console.log("\u2705 \u6d41\u5f0f\u54cd\u5e94\u8bfb\u53d6\u5b8c\u6210"),e.postMessage({type:"end"});break}let r=i.decode(o,{stream:!0});console.log("\uD83D\uDCE6 \u6536\u5230\u6570\u636e\u5757:",r.substring(0,100)+"..."),c+=r;let n=c.split("\n");for(let t of(c=n.pop()||"",n))if(t.startsWith("data: ")){let o=t.substring(6);if("[DONE]"===o){console.log("\u2705 \u6536\u5230\u6d41\u7ed3\u675f\u6807\u8bb0"),e.postMessage({type:"end"});return}try{let t=JSON.parse(o);if(console.log("\uD83D\uDCE6 \u89e3\u6790\u6570\u636e:",t),"error"===t.type){console.warn("\u26a0\ufe0f \u6536\u5230\u9519\u8bef\u6570\u636e\uff0c\u4f46\u7ee7\u7eed\u5904\u7406:",t);continue}["text-start","text-delta","text-end","data-history"].includes(t.type)&&e.postMessage({type:"chunk",chunk:t})}catch(e){console.warn("\u26a0\ufe0f \u89e3\u6790\u6570\u636e\u5757\u5931\u8d25:",t,e)}}}}finally{l.releaseLock()}}catch(t){console.error("\u274c \u6d41\u5f0f\u8bf7\u6c42\u5904\u7406\u5931\u8d25:",t),e.postMessage({type:"error",error:t instanceof Error?t.message:"Unknown error"})}else"abort"===o.type&&(console.log("\uD83D\uDED1 \u4e2d\u6b62\u6d41\u5f0f\u8bf7\u6c42"),t&&t.abort())}),e.onDisconnect.addListener(()=>{console.log("\uD83D\uDD0C \u6d41\u5f0f\u804a\u5929\u8fde\u63a5\u65ad\u5f00"),t&&t.abort()})}async function n(e){try{let t;let{url:o,method:r,headers:n,body:s}=e;if(console.log("\uD83D\uDD17 Background: \u53d1\u9001API\u8bf7\u6c42\u5230",o),console.log("\uD83D\uDCE4 \u8bf7\u6c42\u6570\u636e:",{method:r,headers:n,bodyLength:s?.length}),console.log("\uD83D\uDCE4 \u5b8c\u6574\u8bf7\u6c42\u5934:",n),s)try{let e=JSON.parse(s);console.log("\uD83D\uDCCB \u8bf7\u6c42\u4f53\u5185\u5bb9:",{system:e.system?.substring(0,150),prompt:e.prompt?.substring(0,150),descriptionLength:e.description?.length||0,description:e.description?.substring(0,300)}),console.log("\uD83D\uDD0D \u5b57\u6bb5\u68c0\u67e5:",{hasSystem:!!e.system,hasPrompt:!!e.prompt,hasDescription:!!e.description,systemType:typeof e.system,promptType:typeof e.prompt,descriptionType:typeof e.description})}catch(e){console.log("\uD83D\uDCCB \u8bf7\u6c42\u4f53\uff08\u539f\u59cb\uff09:",s.substring(0,500)+"...")}let a=await fetch(o,{method:r,headers:{"Content-Type":"application/json",Accept:"*/*","Cache-Control":"no-cache",Pragma:"no-cache",...n},body:s});console.log("\uD83D\uDCE5 \u54cd\u5e94\u72b6\u6001:",a.status,a.statusText),console.log("\uD83D\uDCCB \u54cd\u5e94\u5934:",Object.fromEntries(a.headers.entries()));let u=a.headers.get("content-type");u&&u.includes("application/json")?(t=await a.json(),console.log("\u2705 JSON \u54cd\u5e94\u89e3\u6790\u6210\u529f"),console.log("\uD83D\uDCC4 \u54cd\u5e94\u6570\u636e:",{issuesCount:t?.issues?.length||0,summary:t?.summary||null,error:t?.error||null,fullResponse:t})):(t=await a.text(),console.log("\uD83D\uDCDD \u6587\u672c\u54cd\u5e94:",t.substring(0,500)));let l={ok:a.ok,status:a.status,statusText:a.statusText,data:t};return console.log("\uD83C\uDFAF Background: \u8fd4\u56de\u7ed3\u679c:",l),l}catch(e){if(console.error("\u274c Background: API \u8bf7\u6c42\u5931\u8d25",e),e instanceof TypeError&&e.message.includes("fetch"))return{ok:!1,status:0,statusText:"Network Connection Failed",error:"\u65e0\u6cd5\u8fde\u63a5\u5230\u540e\u7aef\u670d\u52a1\uff0c\u8bf7\u786e\u4fdd\u670d\u52a1\u5df2\u542f\u52a8"};return{ok:!1,status:500,statusText:"Network Error",error:e instanceof Error?e.message:"Unknown error"}}}e("~lib/config"),chrome.runtime.onMessage.addListener((e,t,o)=>{if("API_REQUEST"===e.type)return n(e.data).then(e=>o(e)).catch(e=>o({ok:!1,status:500,statusText:"Internal Error",error:e.message})),!0}),chrome.runtime.onConnect.addListener(e=>{"stream-chat"===e.name&&(console.log("\uD83D\uDD0C \u5efa\u7acb\u6d41\u5f0f\u804a\u5929\u8fde\u63a5"),r(e))}),chrome.runtime.onInstalled.addListener(()=>{console.log("Code Review Extension installed")})},{"~lib/config":"kdNLa"}],kdNLa:[function(e,t,o){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(o),r.export(o,"API_BASE_URL",()=>n),r.export(o,"getApiUrl",()=>s),r.export(o,"getApiBaseUrl",()=>a);let n="http://115.190.121.185:3000";function s(e){return`${n}${e}`}function a(){return n}},{"@parcel/transformer-js/src/esmodule-helpers.js":"hbR2Q"}],hbR2Q:[function(e,t,o){o.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},o.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},o.exportAll=function(e,t){return Object.keys(e).forEach(function(o){"default"===o||"__esModule"===o||t.hasOwnProperty(o)||Object.defineProperty(t,o,{enumerable:!0,get:function(){return e[o]}})}),t},o.export=function(e,t,o){Object.defineProperty(e,t,{enumerable:!0,get:o})}},{}]},["kgW6q"],"kgW6q","parcelRequire5e1f"),globalThis.define=t;