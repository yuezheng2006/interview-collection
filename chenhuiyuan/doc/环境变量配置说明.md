# 环境变量配置说明

## 概述

本AI写作助手支持多个AI模型，需要配置相应的环境变量来启用这些模型。本文档详细说明了如何配置各种AI模型的环境变量。

## 环境变量文件

在 `backend` 目录下创建 `.env` 文件，包含以下配置：

```bash
# AI写作助手环境变量配置

# 通义千问配置
TONGYI_API_KEY=your_tongyi_api_key_here
TONGYI_BASE_URL=https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation

# DeepSeek配置
DEEPSEEK_API_KEY=your_deepseek_api_key_here
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1/chat/completions

# 文心一言配置
WENXIN_API_KEY=bce-v3/ALTAK-Cdf9ftiZXfOoSsobxm2Sv/a1f7952832319e63d7b2623c5c9315a73519e2c0
WENXIN_BASE_URL=https://qianfan.baidubce.com/v2/chat/completions

# 智谱AI配置（预留）
ZHIPU_API_KEY=your_zhipu_api_key_here
ZHIPU_BASE_URL=https://open.bigmodel.cn/api/paas/v4/chat/completions

# JWT密钥（生产环境请修改）
JWT_SECRET=DEV_SECRET_CHANGE_ME_IN_PRODUCTION

# 服务器配置
SERVER_PORT=8080
SERVER_HOST=0.0.0.0
```

## 各模型配置说明

### 1. 通义千问 (Tongyi)

**必需配置**:
- `TONGYI_API_KEY`: 通义千问API密钥

**可选配置**:
- `TONGYI_BASE_URL`: API基础URL（有默认值）

**获取方式**:
1. 访问 [阿里云通义千问](https://dashscope.aliyun.com/)
2. 注册账号并开通服务
3. 在控制台获取API密钥

**特点**: 中文支持优秀，适合中文写作

### 2. DeepSeek

**必需配置**:
- `DEEPSEEK_API_KEY`: DeepSeek API密钥

**可选配置**:
- `DEEPSEEK_BASE_URL`: API基础URL（有默认值）

**获取方式**:
1. 访问 [DeepSeek平台](https://platform.deepseek.com/)
2. 注册账号并开通API服务
3. 在控制台获取API密钥

**特点**: 中英文支持优秀，推理能力强，适合创意写作

### 3. 文心一言 (Wenxin)

**必需配置**:
- `WENXIN_API_KEY`: 文心一言API密钥

**可选配置**:
- `WENXIN_BASE_URL`: API基础URL（有默认值）

**获取方式**:
1. 访问 [百度智能云](https://cloud.baidu.com/)
2. 注册账号并完成实名认证
3. 开通文心一言API服务
4. 在控制台获取API密钥

**特点**: 支持16k tokens，知识丰富，适合专业内容和长文本处理

### 4. 智谱AI (Zhipu) - 预留

**必需配置**:
- `ZHIPU_API_KEY`: 智谱AI API密钥

**可选配置**:
- `ZHIPU_BASE_URL`: API基础URL（有默认值）

**获取方式**:
1. 访问 [智谱AI](https://open.bigmodel.cn/)
2. 注册账号并开通服务
3. 获取API密钥

**特点**: 推理能力强，适合逻辑分析

## 配置优先级

### 1. 环境变量优先级
- 系统环境变量 > `.env` 文件 > 代码默认值

### 2. 模型可用性检查
- 系统会自动检查配置的API密钥
- 只有配置了有效API密钥的模型才会显示为可用
- 未配置的模型会显示为不可用状态

### 3. 默认模型
- 系统默认使用Mock模型（无需配置）
- 用户可以在运行时切换到其他可用模型

## 配置验证

### 1. 启动服务后验证
```bash
# 获取可用模型列表
curl -X GET "http://localhost:8080/api/ai/models" \
  -H "Authorization: Bearer your_token"
```

### 2. 检查模型状态
响应中应该包含：
- 模型名称和显示名称
- 提供者信息
- 最大Token数
- 可用状态（isAvailable）
- 当前使用的模型

### 3. 环境变量验证
```bash
# 检查环境变量是否正确设置
echo $TONGYI_API_KEY
echo $DEEPSEEK_API_KEY
echo $WENXIN_API_KEY
echo $ZHIPU_API_KEY
```

## 安全注意事项

### 1. API密钥保护
- **不要提交到版本控制**: `.env` 文件应该添加到 `.gitignore`
- **环境变量**: 生产环境使用系统环境变量
- **访问控制**: 限制API密钥的访问权限
- **定期轮换**: 定期更新API密钥

### 2. 生产环境配置
```bash
# 生产环境示例
export TONGYI_API_KEY="prod_key_here"
export DEEPSEEK_API_KEY="prod_key_here"
export WENXIN_API_KEY="prod_key_here"
export JWT_SECRET="production_secret_here"
```

### 3. 开发环境配置
```bash
# 开发环境示例
cp .env.example .env
# 编辑 .env 文件，填入测试用的API密钥
```

## 故障排除

### 1. 常见问题

#### API密钥无效
**症状**: 模型显示为不可用状态
**解决**: 检查API密钥是否正确，确认服务是否开通

#### 环境变量未生效
**症状**: 配置了环境变量但模型仍不可用
**解决**: 重启服务，检查环境变量文件格式

#### 网络连接问题
**症状**: 模型可用但API调用失败
**解决**: 检查网络连接，确认防火墙设置

### 2. 调试步骤

1. **检查环境变量**
   ```bash
   env | grep -E "(TONGYI|DEEPSEEK|WENXIN|ZHIPU)"
   ```

2. **检查服务日志**
   ```bash
   tail -f backend.log
   ```

3. **测试API接口**
   ```bash
   curl -X GET "http://localhost:8080/api/ai/models"
   ```

4. **验证配置文件**
   ```bash
   cat backend/.env
   ```

## 最佳实践

### 1. 配置管理
- 使用 `.env.example` 作为模板
- 不同环境使用不同的配置文件
- 定期检查和更新API密钥

### 2. 模型选择
- 根据具体需求选择合适的模型
- 考虑模型的token限制和特点
- 平衡效果和成本

### 3. 监控和维护
- 监控API调用成功率
- 定期检查模型可用性
- 及时处理配置问题

## 总结

正确配置环境变量是使用AI写作助手的关键。通过合理配置，用户可以享受到多模型AI写作服务，提升创作效率和质量。

### 配置要点
1. 创建 `.env` 文件并配置API密钥
2. 确保API密钥的有效性和安全性
3. 验证配置是否正确生效
4. 根据需求选择合适的AI模型

### 推荐配置
- **中文写作**: 通义千问
- **创意写作**: DeepSeek
- **长文本处理**: 文心一言（16k tokens支持）
- **逻辑分析**: 智谱AI 